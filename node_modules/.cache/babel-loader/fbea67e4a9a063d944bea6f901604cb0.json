{"ast":null,"code":"import _slicedToArray from \"/home/yamakasi/React/react_chat_socketio/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _taggedTemplateLiteral from \"/home/yamakasi/React/react_chat_socketio/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";\nvar _jsxFileName = \"/home/yamakasi/React/react_chat_socketio/src/components/chats/ChatItem.jsx\";\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"\\n  margin: 0;\\n  padding: 4px 0;\\n  width: auto;\\n  height: 50px;\\n  display: flex;\\n  flex-direction: column;\\n  align-items: start;\\n  transition: all 300ms ease-in;\\n  border-bottom: 2px solid rgba(255, 255, 255, .4);\\n  position: relative;\\n  cursor: pointer;\\n\\n  &:hover {\\n    background-color: #32465a;\\n    padding-left: 16px;\\n    border-right: 0.6em solid white;\\n    color: white;\\n  }\\n\\n  & .chat-name {\\n    font-size: 1.5em;\\n    margin-left: 8px;\\n    text-shadow: 2px 2px 4px rgba(0, 0, 0, .6);\\n  }\\n\\n  & .chat-text {\\n    font-size: 1.2em;\\n    padding-left: 8px;\\n    padding-right: 16px;\\n    margin-left: 16px;\\n  }\\n\\n  & .chat-count-unread {\\n    position: absolute;\\n    font-size: 1.5em;\\n    right: 5%;\\n    top: 50%;\\n    border: 1px solid white;\\n    border-radius: 50%;\\n    padding: 4px;\\n    transform: translate3d(0, -50%, 0);\\n  }\\n\\n  & .chat-actions {\\n    margin-left: auto;\\n    margin-right: 8px;\\n\\n    & > .chat {\\n      background-color: #FFA500;\\n    }\\n\\n    & > .chat-actions-btn {\\n      cursor: pointer;\\n      text-shadow: 2px 2px 4px rgba(0, 0, 0, .6);\\n      box-shadow: 2px 2px 4px rgba(0, 0, 0, .6);\\n      margin: 0px 4px;\\n    }\\n  }\\n\"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\nimport React, { useEffect, useState } from \"react\";\nimport styled from \"styled-components\";\nimport { useAppHooks } from \"../../contexts\";\nimport { CHAT_SELECTED } from \"../../reducers/transitionReducer\";\nimport isMobile from \"../../utils/isMobile\";\nimport OpenChatIcon from \"../icons/OpenChatIcon\";\nimport { socketOn } from \"../../socket\";\nvar ChatItemStyle = styled.li(_templateObject());\n\nvar ChatItem = function ChatItem(_ref) {\n  var chat = _ref.chat;\n\n  var _useAppHooks = useAppHooks(),\n      useAuth = _useAppHooks.useAuth,\n      useTransition = _useAppHooks.useTransition,\n      history = _useAppHooks.history,\n      socket = _useAppHooks.socket;\n\n  var _useAuth = _slicedToArray(useAuth, 2),\n      user = _useAuth[0].user,\n      dispatchAuth = _useAuth[1];\n\n  var _useTransition = _slicedToArray(useTransition, 2),\n      transition = _useTransition[0],\n      dispatchTransition = _useTransition[1];\n\n  var _useState = useState(chat.users.find(function (u) {\n    return u.id !== user.id;\n  })),\n      _useState2 = _slicedToArray(_useState, 2),\n      contact = _useState2[0],\n      setContact = _useState2[1];\n\n  var _useState3 = useState(),\n      _useState4 = _slicedToArray(_useState3, 2),\n      lastMsg = _useState4[0],\n      setLastMsg = _useState4[1];\n\n  var _useState5 = useState(0),\n      _useState6 = _slicedToArray(_useState5, 2),\n      nbUnread = _useState6[0],\n      setUnread = _useState6[1];\n\n  var openChat = function openChat(e) {\n    console.log('open');\n    if (isMobile) dispatchTransition({\n      type: CHAT_SELECTED,\n      payload: true\n    });\n    history.push(\"/chats/\".concat(chat.id));\n  };\n\n  socketOn('count-unread-message', socket, chat, function (data, chat) {\n    if (data && data.unread && data.chat.unreads.length > 0 && data.users.find(function (u) {\n      return u.id === user.id;\n    }) && data.chat.id === chat.id) {\n      setUnread(data.chat.unreads.length);\n    }\n\n    if (data && data.message) {\n      setLastMsg(data.message.text);\n    }\n  });\n  socketOn('count-read-message', socket, chat, function (data, chat) {\n    if (user && data && data.chat.id === chat.id && data.chat.unreads.length === 0 && data.userId === user.id) {\n      // console.log(data)\n      setUnread(0);\n    }\n  });\n  useEffect(function () {\n    if (chat.messages.length > 0) setLastMsg(chat.messages.reverse()[0].text);\n    if (chat.unreads.length > 0 && chat.unreads.find(function (u) {\n      return u.authorId !== user.id;\n    })) setUnread(chat.unreads.length);\n  }, []);\n  return React.createElement(ChatItemStyle, {\n    onClick: openChat,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 108\n    },\n    __self: this\n  }, nbUnread > 0 && React.createElement(\"span\", {\n    className: \"chat-count-unread\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 109\n    },\n    __self: this\n  }, nbUnread), contact && React.createElement(\"span\", {\n    className: \"chat-name\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 110\n    },\n    __self: this\n  }, contact.name), React.createElement(\"span\", {\n    className: \"chat-text\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 111\n    },\n    __self: this\n  }, lastMsg));\n};\n\nexport default ChatItem;","map":{"version":3,"sources":["/home/yamakasi/React/react_chat_socketio/src/components/chats/ChatItem.jsx"],"names":["React","useEffect","useState","styled","useAppHooks","CHAT_SELECTED","isMobile","OpenChatIcon","socketOn","ChatItemStyle","li","ChatItem","chat","useAuth","useTransition","history","socket","user","dispatchAuth","transition","dispatchTransition","users","find","u","id","contact","setContact","lastMsg","setLastMsg","nbUnread","setUnread","openChat","e","console","log","type","payload","push","data","unread","unreads","length","message","text","userId","messages","reverse","authorId","name"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport styled from \"styled-components\";\nimport { useAppHooks } from \"../../contexts\";\nimport { CHAT_SELECTED } from \"../../reducers/transitionReducer\";\nimport isMobile from \"../../utils/isMobile\";\nimport OpenChatIcon from \"../icons/OpenChatIcon\";\nimport { socketOn } from \"../../socket\";\n\nconst ChatItemStyle = styled.li`\n  margin: 0;\n  padding: 4px 0;\n  width: auto;\n  height: 50px;\n  display: flex;\n  flex-direction: column;\n  align-items: start;\n  transition: all 300ms ease-in;\n  border-bottom: 2px solid rgba(255, 255, 255, .4);\n  position: relative;\n  cursor: pointer;\n\n  &:hover {\n    background-color: #32465a;\n    padding-left: 16px;\n    border-right: 0.6em solid white;\n    color: white;\n  }\n\n  & .chat-name {\n    font-size: 1.5em;\n    margin-left: 8px;\n    text-shadow: 2px 2px 4px rgba(0, 0, 0, .6);\n  }\n\n  & .chat-text {\n    font-size: 1.2em;\n    padding-left: 8px;\n    padding-right: 16px;\n    margin-left: 16px;\n  }\n\n  & .chat-count-unread {\n    position: absolute;\n    font-size: 1.5em;\n    right: 5%;\n    top: 50%;\n    border: 1px solid white;\n    border-radius: 50%;\n    padding: 4px;\n    transform: translate3d(0, -50%, 0);\n  }\n\n  & .chat-actions {\n    margin-left: auto;\n    margin-right: 8px;\n\n    & > .chat {\n      background-color: #FFA500;\n    }\n\n    & > .chat-actions-btn {\n      cursor: pointer;\n      text-shadow: 2px 2px 4px rgba(0, 0, 0, .6);\n      box-shadow: 2px 2px 4px rgba(0, 0, 0, .6);\n      margin: 0px 4px;\n    }\n  }\n`;\n\nconst ChatItem = ({ chat }) => {\n  const { useAuth, useTransition, history, socket } = useAppHooks();\n  const [{ user }, dispatchAuth] = useAuth;\n  const [transition, dispatchTransition] = useTransition;\n\n  const [contact, setContact] = useState(chat.users.find(u => u.id !== user.id))\n  const [lastMsg, setLastMsg] = useState()\n  const [nbUnread, setUnread] = useState(0)\n\n  const openChat = e => {\n    console.log('open')\n    if (isMobile) dispatchTransition({ type: CHAT_SELECTED, payload: true });\n    history.push(`/chats/${chat.id}`);\n  };\n\n  socketOn('count-unread-message', socket, chat, (data, chat) => {\n    if (data && data.unread && data.chat.unreads.length > 0 && data.users.find(u => u.id === user.id) && data.chat.id === chat.id) {\n      setUnread(data.chat.unreads.length)\n    }\n\n    if (data && data.message) {\n      setLastMsg(data.message.text)\n    }\n  })\n\n  socketOn('count-read-message', socket, chat, (data, chat) => {\n    if (user && data && data.chat.id === chat.id && data.chat.unreads.length === 0 && data.userId === user.id) {\n      // console.log(data)\n      setUnread(0)\n    }\n  })\n\n  useEffect(() => {\n    if (chat.messages.length > 0) setLastMsg(chat.messages.reverse()[0].text)\n    if (chat.unreads.length > 0 && chat.unreads.find(u => u.authorId !== user.id)) setUnread(chat.unreads.length)\n  }, [])\n\n  return (\n    <ChatItemStyle onClick={openChat}>\n      {nbUnread > 0 && <span className='chat-count-unread'>{nbUnread}</span>}\n      {contact && <span className=\"chat-name\">{contact.name}</span>}\n      <span className=\"chat-text\">{lastMsg}</span>\n    </ChatItemStyle>\n  );\n};\n\nexport default ChatItem;\n"]},"metadata":{},"sourceType":"module"}