{"ast":null,"code":"import _slicedToArray from \"/home/yamakasi/React/react_chat_socketio/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _taggedTemplateLiteral from \"/home/yamakasi/React/react_chat_socketio/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";\nvar _jsxFileName = \"/home/yamakasi/React/react_chat_socketio/src/components/chats/ChatItem.jsx\";\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"\\n  margin: 0;\\n  padding: 4px 0;\\n  width: auto;\\n  height: 50px;\\n  display: flex;\\n  flex-direction: column;\\n  align-items: start;\\n  transition: all 300ms ease-in;\\n  border-bottom: 2px solid rgba(255, 255, 255, .4);\\n  position: relative;\\n  cursor: pointer;\\n\\n  &:hover {\\n    background-color: #32465a;\\n    padding-left: 16px;\\n    border-right: 0.6em solid white;\\n    color: white;\\n  }\\n\\n  & .chat-name {\\n    font-size: 1.5em;\\n    margin-left: 8px;\\n    text-shadow: 2px 2px 4px rgba(0, 0, 0, .6);\\n  }\\n\\n  & .chat-text {\\n    font-size: 1.2em;\\n    padding-left: 8px;\\n    padding-right: 16px;\\n    margin-left: 16px;\\n  }\\n\\n  & .green {\\n    color: yellowgreen;\\n    text-shadow: 2px 2px 4px rgba(0, 0, 0, .6);\\n  }\\n\\n  & .chat-count-unread {\\n    position: absolute;\\n    font-size: 1.5em;\\n    right: 5%;\\n    top: 50%;\\n    border: 1px solid white;\\n    border-radius: 50%;\\n    padding: 4px;\\n    transform: translate3d(0, -50%, 0);\\n  }\\n\\n  & .chat-actions {\\n    margin-left: auto;\\n    margin-right: 8px;\\n\\n    & > .chat {\\n      background-color: #FFA500;\\n    }\\n\\n    & > .chat-actions-btn {\\n      cursor: pointer;\\n      text-shadow: 2px 2px 4px rgba(0, 0, 0, .6);\\n      box-shadow: 2px 2px 4px rgba(0, 0, 0, .6);\\n      margin: 0px 4px;\\n    }\\n  }\\n\"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\nimport React, { useEffect, useState } from \"react\";\nimport styled from \"styled-components\";\nimport { useAppHooks } from \"../../contexts\";\nimport { CHAT_SELECTED } from \"../../reducers/transitionReducer\";\nimport isMobile from \"../../utils/isMobile\";\nimport OpenChatIcon from \"../icons/OpenChatIcon\";\nimport { socketOn } from \"../../socket\";\nvar ChatItemStyle = styled.li(_templateObject());\n\nvar ChatItem = function ChatItem(_ref) {\n  var chat = _ref.chat;\n\n  var _useAppHooks = useAppHooks(),\n      useAuth = _useAppHooks.useAuth,\n      useTransition = _useAppHooks.useTransition,\n      history = _useAppHooks.history,\n      socket = _useAppHooks.socket;\n\n  var _useAuth = _slicedToArray(useAuth, 2),\n      user = _useAuth[0].user,\n      dispatchAuth = _useAuth[1];\n\n  var _useTransition = _slicedToArray(useTransition, 2),\n      transition = _useTransition[0],\n      dispatchTransition = _useTransition[1];\n\n  var _useState = useState(null),\n      _useState2 = _slicedToArray(_useState, 2),\n      contact = _useState2[0],\n      setContact = _useState2[1];\n\n  var _useState3 = useState([]),\n      _useState4 = _slicedToArray(_useState3, 2),\n      contacts = _useState4[0],\n      setContacts = _useState4[1];\n\n  var _useState5 = useState([]),\n      _useState6 = _slicedToArray(_useState5, 2),\n      lastMsg = _useState6[0],\n      setLastMsg = _useState6[1];\n\n  var _useState7 = useState(0),\n      _useState8 = _slicedToArray(_useState7, 2),\n      nbUnread = _useState8[0],\n      setUnread = _useState8[1];\n\n  var openChat = function openChat(e) {\n    console.log('open');\n    if (isMobile) dispatchTransition({\n      type: CHAT_SELECTED,\n      payload: true\n    });\n    history.push(\"/chats/\".concat(chat.id));\n  };\n\n  socketOn('count-unread-message', socket, chat, function (data, chat) {\n    if (data && data.chat.unreads.length > 0 && data.users.find(function (u) {\n      return u.id === user.id;\n    }) && data.chat.id === chat.id) {\n      setUnread(nbUnread + 1);\n    }\n\n    if (data && data.chat.unreads.length > 0 && data.chat.id === chat.id && data.message) {\n      setLastMsg(data.message.text);\n    }\n  });\n  socketOn('count-read-message', socket, chat, function (data, chat) {\n    if (user && data && data.chat.id === chat.id && data.chat.unreads.length === 0 && data.userId === user.id) {\n      // console.log(data)\n      setUnread(0);\n    }\n  });\n  useEffect(function () {\n    if (user) {\n      if (chat.users.length === 1) {\n        setContact(chat.users.find(function (u) {\n          return u.id !== user.id;\n        }));\n      }\n\n      if (chat.users.length > 1) {\n        setContacts(chat.users.filter(function (u) {\n          return u.id !== user.id;\n        }));\n      }\n\n      if (chat.messages.length > 0) {\n        setLastMsg(chat.messages[0]);\n      }\n\n      if (chat.unreads.length > 0 && chat.unreads.find(function (u) {\n        return u.authorId !== user.id;\n      })) {\n        setUnread(chat.unreads.length);\n      }\n    }\n  }, []);\n  return React.createElement(ChatItemStyle, {\n    onClick: openChat,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 125\n    },\n    __self: this\n  }, nbUnread > 0 && React.createElement(\"span\", {\n    className: \"chat-count-unread\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 126\n    },\n    __self: this\n  }, nbUnread), contact && React.createElement(\"span\", {\n    className: \"chat-name\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 127\n    },\n    __self: this\n  }, contact.name), contacts.length > 0 && contacts.map(function (contact, i) {\n    return React.createElement(\"span\", {\n      key: i,\n      className: \"chat-name\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 130\n      },\n      __self: this\n    }, i < 2 && contact.name, i === 2 && \"\".concat(contacts.length - 2), i !== contacts.length - 1 && contacts.length === 2 && ', ');\n  }), React.createElement(\"span\", {\n    className: \"chat-text \".concat(lastMsg.authorId !== user.id && 'green'),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 137\n    },\n    __self: this\n  }, lastMsg.text));\n};\n\nexport default ChatItem;","map":{"version":3,"sources":["/home/yamakasi/React/react_chat_socketio/src/components/chats/ChatItem.jsx"],"names":["React","useEffect","useState","styled","useAppHooks","CHAT_SELECTED","isMobile","OpenChatIcon","socketOn","ChatItemStyle","li","ChatItem","chat","useAuth","useTransition","history","socket","user","dispatchAuth","transition","dispatchTransition","contact","setContact","contacts","setContacts","lastMsg","setLastMsg","nbUnread","setUnread","openChat","e","console","log","type","payload","push","id","data","unreads","length","users","find","u","message","text","userId","filter","messages","authorId","name","map","i"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport styled from \"styled-components\";\nimport { useAppHooks } from \"../../contexts\";\nimport { CHAT_SELECTED } from \"../../reducers/transitionReducer\";\nimport isMobile from \"../../utils/isMobile\";\nimport OpenChatIcon from \"../icons/OpenChatIcon\";\nimport { socketOn } from \"../../socket\";\n\nconst ChatItemStyle = styled.li`\n  margin: 0;\n  padding: 4px 0;\n  width: auto;\n  height: 50px;\n  display: flex;\n  flex-direction: column;\n  align-items: start;\n  transition: all 300ms ease-in;\n  border-bottom: 2px solid rgba(255, 255, 255, .4);\n  position: relative;\n  cursor: pointer;\n\n  &:hover {\n    background-color: #32465a;\n    padding-left: 16px;\n    border-right: 0.6em solid white;\n    color: white;\n  }\n\n  & .chat-name {\n    font-size: 1.5em;\n    margin-left: 8px;\n    text-shadow: 2px 2px 4px rgba(0, 0, 0, .6);\n  }\n\n  & .chat-text {\n    font-size: 1.2em;\n    padding-left: 8px;\n    padding-right: 16px;\n    margin-left: 16px;\n  }\n\n  & .green {\n    color: yellowgreen;\n    text-shadow: 2px 2px 4px rgba(0, 0, 0, .6);\n  }\n\n  & .chat-count-unread {\n    position: absolute;\n    font-size: 1.5em;\n    right: 5%;\n    top: 50%;\n    border: 1px solid white;\n    border-radius: 50%;\n    padding: 4px;\n    transform: translate3d(0, -50%, 0);\n  }\n\n  & .chat-actions {\n    margin-left: auto;\n    margin-right: 8px;\n\n    & > .chat {\n      background-color: #FFA500;\n    }\n\n    & > .chat-actions-btn {\n      cursor: pointer;\n      text-shadow: 2px 2px 4px rgba(0, 0, 0, .6);\n      box-shadow: 2px 2px 4px rgba(0, 0, 0, .6);\n      margin: 0px 4px;\n    }\n  }\n`;\n\nconst ChatItem = ({ chat }) => {\n  const { useAuth, useTransition, history, socket } = useAppHooks();\n  const [{ user }, dispatchAuth] = useAuth;\n  const [transition, dispatchTransition] = useTransition;\n\n  const [contact, setContact] = useState(null)\n  const [contacts, setContacts] = useState([])\n  const [lastMsg, setLastMsg] = useState([])\n  const [nbUnread, setUnread] = useState(0)\n\n  const openChat = e => {\n    console.log('open')\n    if (isMobile) dispatchTransition({ type: CHAT_SELECTED, payload: true });\n    history.push(`/chats/${chat.id}`);\n  };\n\n  socketOn('count-unread-message', socket, chat, (data, chat) => {\n    if (data && data.chat.unreads.length > 0 && data.users.find(u => u.id === user.id) && data.chat.id === chat.id) {\n      setUnread(nbUnread + 1)\n    }\n    if (data && data.chat.unreads.length > 0 && data.chat.id === chat.id && data.message) {\n      setLastMsg(data.message.text)\n    }\n  })\n\n  socketOn('count-read-message', socket, chat, (data, chat) => {\n    if (user && data && data.chat.id === chat.id && data.chat.unreads.length === 0 && data.userId === user.id) {\n      // console.log(data)\n      setUnread(0)\n    }\n  })\n\n  useEffect(() => {\n    if (user) {\n      if (chat.users.length === 1) {\n        setContact(chat.users.find(u => u.id !== user.id))\n      }\n      if (chat.users.length > 1) {\n        setContacts(chat.users.filter(u => u.id !== user.id))\n      }\n      if (chat.messages.length > 0) {\n        setLastMsg(chat.messages[0])\n      }\n      if (chat.unreads.length > 0 && chat.unreads.find(u => u.authorId !== user.id)) {\n        setUnread(chat.unreads.length)\n      }\n    }\n  }, [])\n\n  return (\n    <ChatItemStyle onClick={openChat}>\n      {nbUnread > 0 && <span className='chat-count-unread'>{nbUnread}</span>}\n      {contact && <span className=\"chat-name\">{contact.name}</span>}\n      {\n        contacts.length > 0 && contacts.map((contact, i) => (\n          <span key={i} className=\"chat-name\">\n            {i < 2 && contact.name}\n            {i === 2 && `${contacts.length - 2}`}\n            {i !== contacts.length - 1 && contacts.length === 2 && ', '}\n          </span>\n        ))\n      }\n      <span className={`chat-text ${lastMsg.authorId !== user.id && 'green'}`}>{lastMsg.text}</span>\n    </ChatItemStyle>\n  );\n};\n\nexport default ChatItem;\n"]},"metadata":{},"sourceType":"module"}