{"ast":null,"code":"import _regeneratorRuntime from \"/home/yamakasi/React/react_chat_socketio/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/home/yamakasi/React/react_chat_socketio/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"/home/yamakasi/React/react_chat_socketio/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _taggedTemplateLiteral from \"/home/yamakasi/React/react_chat_socketio/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";\nvar _jsxFileName = \"/home/yamakasi/React/react_chat_socketio/src/components/chats/ChatItem.jsx\";\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"\\n  margin: 0;\\n  padding: 4px 0;\\n  width: auto;\\n  height: 50px;\\n  display: flex;\\n  flex-direction: column;\\n  align-items: start;\\n  transition: all 300ms ease-in;\\n  border-bottom: 2px solid rgba(255, 255, 255, .4);\\n  position: relative;\\n\\n  &:hover {\\n    background-color: #32465a;\\n    padding-left: 16px;\\n    border-right: 0.6em solid white;\\n    color: white;\\n  }\\n\\n  & .chat-name {\\n    font-size: 1.5em;\\n    margin-left: 8px;\\n    text-shadow: 2px 2px 4px rgba(0, 0, 0, .6);\\n  }\\n\\n  & .chat-text {\\n    font-size: 1.2em;\\n    padding-left: 8px;\\n    padding-right: 16px;\\n    margin-left: 16px;\\n  }\\n\\n  & .chat-count-unread {\\n    position: absolute;\\n    font-size: 1.5em;\\n    right: 5%;\\n    top: 50%;\\n    border: 1px solid white;\\n    border-radius: 50%;\\n    transform: translate3d(0, -50%, 0);\\n  }\\n\\n  & .chat-actions {\\n    margin-left: auto;\\n    margin-right: 8px;\\n\\n    & > .chat {\\n      background-color: #FFA500;\\n    }\\n\\n    & > .chat-actions-btn {\\n      cursor: pointer;\\n      text-shadow: 2px 2px 4px rgba(0, 0, 0, .6);\\n      box-shadow: 2px 2px 4px rgba(0, 0, 0, .6);\\n      margin: 0px 4px;\\n    }\\n  }\\n\"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\nimport React, { useEffect, useState } from \"react\";\nimport styled from \"styled-components\";\nimport { useAppHooks } from \"../../contexts\";\nimport { CHAT_SELECTED } from \"../../reducers/transitionReducer\";\nimport isMobile from \"../../utils/isMobile\";\nimport api from \"../../api\";\nimport OpenChatIcon from \"../icons/OpenChatIcon\";\nimport { socketEmit, socketOn } from \"../../socket\";\nvar ChatItemStyle = styled.li(_templateObject());\n\nvar ChatItem = function ChatItem(_ref) {\n  var chat = _ref.chat;\n\n  var _useAppHooks = useAppHooks(),\n      useAuth = _useAppHooks.useAuth,\n      useTransition = _useAppHooks.useTransition,\n      history = _useAppHooks.history,\n      socket = _useAppHooks.socket;\n\n  var _useAuth = _slicedToArray(useAuth, 2),\n      user = _useAuth[0].user,\n      dispatchAuth = _useAuth[1];\n\n  var _useTransition = _slicedToArray(useTransition, 2),\n      transition = _useTransition[0],\n      dispatchTransition = _useTransition[1];\n\n  var _useState = useState(chat.users.find(function (u) {\n    return u.id !== user.id;\n  })),\n      _useState2 = _slicedToArray(_useState, 2),\n      contact = _useState2[0],\n      setContact = _useState2[1];\n\n  var _useState3 = useState(chat.messages[0].text),\n      _useState4 = _slicedToArray(_useState3, 2),\n      lastMsg = _useState4[0],\n      setLastMsg = _useState4[1];\n\n  var _useState5 = useState(chat.unreads.length),\n      _useState6 = _slicedToArray(_useState5, 2),\n      nbUnread = _useState6[0],\n      setUnread = _useState6[1];\n\n  var openChat =\n  /*#__PURE__*/\n  function () {\n    var _ref2 = _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee() {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              if (isMobile) dispatchTransition({\n                type: CHAT_SELECTED,\n                payload: true\n              });\n              history.push(\"/chats/\".concat(chat.id));\n\n            case 2:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function openChat() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  socketOn('count-unread-message', socket, chat, function (data, chat) {\n    if (data && data.unread && data.unread.userId === user.id && data.unread.chatId === chat.id) {\n      setUnread(function (prevUnread) {\n        return prevUnread + 1;\n      });\n    } else {\n      setUnread(function (prevUnread) {\n        return prevUnread === 1 ? 0 : prevUnread - 1;\n      });\n    }\n  });\n  console.log(chat);\n  return React.createElement(ChatItemStyle, {\n    handleClick: openChat,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 94\n    },\n    __self: this\n  }, nbUnread > 0 && React.createElement(\"span\", {\n    className: \"chat-count-unread\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 95\n    },\n    __self: this\n  }, nbUnread), contact && React.createElement(\"span\", {\n    className: \"chat-name\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 96\n    },\n    __self: this\n  }, contact.name), React.createElement(\"span\", {\n    className: \"chat-text\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 97\n    },\n    __self: this\n  }, lastMsg));\n};\n\nexport default ChatItem;","map":{"version":3,"sources":["/home/yamakasi/React/react_chat_socketio/src/components/chats/ChatItem.jsx"],"names":["React","useEffect","useState","styled","useAppHooks","CHAT_SELECTED","isMobile","api","OpenChatIcon","socketEmit","socketOn","ChatItemStyle","li","ChatItem","chat","useAuth","useTransition","history","socket","user","dispatchAuth","transition","dispatchTransition","users","find","u","id","contact","setContact","messages","text","lastMsg","setLastMsg","unreads","length","nbUnread","setUnread","openChat","type","payload","push","data","unread","userId","chatId","prevUnread","console","log","name"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport styled from \"styled-components\";\nimport { useAppHooks } from \"../../contexts\";\nimport { CHAT_SELECTED } from \"../../reducers/transitionReducer\";\nimport isMobile from \"../../utils/isMobile\";\nimport api from \"../../api\";\nimport OpenChatIcon from \"../icons/OpenChatIcon\";\nimport { socketEmit, socketOn } from \"../../socket\";\n\nconst ChatItemStyle = styled.li`\n  margin: 0;\n  padding: 4px 0;\n  width: auto;\n  height: 50px;\n  display: flex;\n  flex-direction: column;\n  align-items: start;\n  transition: all 300ms ease-in;\n  border-bottom: 2px solid rgba(255, 255, 255, .4);\n  position: relative;\n\n  &:hover {\n    background-color: #32465a;\n    padding-left: 16px;\n    border-right: 0.6em solid white;\n    color: white;\n  }\n\n  & .chat-name {\n    font-size: 1.5em;\n    margin-left: 8px;\n    text-shadow: 2px 2px 4px rgba(0, 0, 0, .6);\n  }\n\n  & .chat-text {\n    font-size: 1.2em;\n    padding-left: 8px;\n    padding-right: 16px;\n    margin-left: 16px;\n  }\n\n  & .chat-count-unread {\n    position: absolute;\n    font-size: 1.5em;\n    right: 5%;\n    top: 50%;\n    border: 1px solid white;\n    border-radius: 50%;\n    transform: translate3d(0, -50%, 0);\n  }\n\n  & .chat-actions {\n    margin-left: auto;\n    margin-right: 8px;\n\n    & > .chat {\n      background-color: #FFA500;\n    }\n\n    & > .chat-actions-btn {\n      cursor: pointer;\n      text-shadow: 2px 2px 4px rgba(0, 0, 0, .6);\n      box-shadow: 2px 2px 4px rgba(0, 0, 0, .6);\n      margin: 0px 4px;\n    }\n  }\n`;\n\nconst ChatItem = ({ chat }) => {\n    const { useAuth, useTransition, history, socket } = useAppHooks();\n    const [{ user }, dispatchAuth] = useAuth;\n    const [transition, dispatchTransition] = useTransition;\n\n    const [contact, setContact] = useState(chat.users.find(u => u.id !== user.id))\n    const [lastMsg, setLastMsg] = useState(chat.messages[0].text)\n    const [nbUnread, setUnread] = useState(chat.unreads.length)\n\n    const openChat = async () => {\n        if (isMobile) dispatchTransition({ type: CHAT_SELECTED, payload: true });\n        history.push(`/chats/${chat.id}`);\n    };\n\n    socketOn('count-unread-message', socket, chat, (data, chat) => {\n      if (data && data.unread && data.unread.userId === user.id && data.unread.chatId === chat.id) {\n        setUnread(prevUnread => prevUnread + 1)\n      }\n      else {\n        setUnread(prevUnread => prevUnread === 1 ? 0 : prevUnread - 1)\n      }\n    })\n\n    console.log(chat)\n\n    return <ChatItemStyle handleClick={openChat}>\n        {nbUnread > 0 && <span className='chat-count-unread'>{nbUnread}</span>}\n        {contact && <span className=\"chat-name\">{contact.name}</span>}\n        <span className=\"chat-text\">{lastMsg}</span>\n    </ChatItemStyle>;\n};\n\nexport default ChatItem;\n"]},"metadata":{},"sourceType":"module"}