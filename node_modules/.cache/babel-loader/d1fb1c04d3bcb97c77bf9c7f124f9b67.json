{"ast":null,"code":"import _regeneratorRuntime from \"/home/yamakasi/React/react_chat_socketio/node_modules/@babel/runtime/regenerator\";\nimport _defineProperty from \"/home/yamakasi/React/react_chat_socketio/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _asyncToGenerator from \"/home/yamakasi/React/react_chat_socketio/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"/home/yamakasi/React/react_chat_socketio/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _taggedTemplateLiteral from \"/home/yamakasi/React/react_chat_socketio/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";\nvar _jsxFileName = \"/home/yamakasi/React/react_chat_socketio/src/components/forms/LoginForm.jsx\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _templateObject3() {\n  var data = _taggedTemplateLiteral([\"\\n  background-color: forestgreen;\\n  color: white;\\n  margin-top: 15px;\\n  border-radius: 5px;\\n  padding: 3px;\\n  border: none;\\n  box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.4);\\n\"]);\n\n  _templateObject3 = function _templateObject3() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject2() {\n  var data = _taggedTemplateLiteral([\"\\n  margin-right: 10px;\\n\"]);\n\n  _templateObject2 = function _templateObject2() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"\\n  padding: 0 10px 20px;\\n  display: flex;\\n  flex-direction: column;\\n\\n  & span {\\n    margin: 10px 0;\\n  }\\n\"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\nimport React, { useState, useEffect } from \"react\";\nimport styled from \"styled-components\";\nimport { useAppHooks } from \"../../contexts\";\nimport { AUTH_FAILED, RESET_ERROR, CONNECTED } from \"../../reducers/authReducer\";\nimport EmailInput from \"../inputs/EmailInput\";\nimport PwdInput from \"../inputs/PwdInput\";\nimport api from \"../../api\";\nimport storeToken from \"../../utils/storeToken\";\nimport axios from \"axios\";\nvar FormStyle = styled.form(_templateObject());\nvar LabelStyle = styled.label(_templateObject2());\nvar ButtonStyle = styled.button(_templateObject3());\n\nvar LoginForm = function LoginForm() {\n  var _useAppHooks = useAppHooks(),\n      useAuth = _useAppHooks.useAuth,\n      history = _useAppHooks.history;\n\n  var _useAuth = _slicedToArray(useAuth, 2),\n      _useAuth$ = _useAuth[0],\n      error = _useAuth$.error,\n      isConnected = _useAuth$.isConnected,\n      dispatch = _useAuth[1];\n\n  var _useState = useState(null),\n      _useState2 = _slicedToArray(_useState, 2),\n      email = _useState2[0],\n      setEmail = _useState2[1];\n\n  var _useState3 = useState(null),\n      _useState4 = _slicedToArray(_useState3, 2),\n      password = _useState4[0],\n      setPassword = _useState4[1];\n\n  var _useState5 = useState(null),\n      _useState6 = _slicedToArray(_useState5, 2),\n      errorLogin = _useState6[0],\n      setError = _useState6[1];\n\n  var handleSubmit =\n  /*#__PURE__*/\n  function () {\n    var _ref = _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee(e) {\n      var res;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              e.preventDefault();\n              _context.prev = 1;\n\n              if (!(email && password)) {\n                _context.next = 12;\n                break;\n              }\n\n              _context.next = 5;\n              return api.user.login(email, password);\n\n            case 5:\n              res = _context.sent;\n              storeToken(res);\n              dispatch({\n                type: CONNECTED\n              });\n              setEmail(null);\n              setPassword(null);\n              _context.next = 13;\n              break;\n\n            case 12:\n              if (!email) {\n                setError(function (prevError) {\n                  return _objectSpread({}, prevError, {\n                    email: {\n                      message: \"Username is required\"\n                    }\n                  });\n                });\n              } else if (!password) {\n                setError(function (prevError) {\n                  return _objectSpread({}, prevError, {\n                    password: {\n                      message: \"Password is required\"\n                    }\n                  });\n                });\n              }\n\n            case 13:\n              _context.next = 18;\n              break;\n\n            case 15:\n              _context.prev = 15;\n              _context.t0 = _context[\"catch\"](1);\n              dispatch({\n                type: AUTH_FAILED,\n                payload: _context.t0.response.data\n              });\n\n            case 18:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[1, 15]]);\n    }));\n\n    return function handleSubmit(_x) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  useEffect(function () {\n    if (error) setError(error);\n    return function () {\n      return dispatch({\n        type: RESET_ERROR\n      });\n    };\n  }, [error, dispatch]);\n  useEffect(function () {\n    if (errorLogin) {\n      console.log(errorLogin);\n\n      if (errorLogin.email) {\n        alert(errorLogin.email.message);\n      } else if (errorLogin.password) {\n        alert(errorLogin.password.message);\n      } else if (errorLogin.msg) {\n        alert(errorLogin.msg);\n      }\n    }\n\n    return function () {\n      return setError(null);\n    };\n  }, [errorLogin]);\n  useEffect(function () {\n    if (isConnected) {\n      history.replace(\"/\");\n    }\n  }, [isConnected, history]);\n  return React.createElement(FormStyle, {\n    onSubmit: handleSubmit,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 96\n    },\n    __self: this\n  }, React.createElement(\"span\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 97\n    },\n    __self: this\n  }, React.createElement(LabelStyle, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 98\n    },\n    __self: this\n  }, \"Email\"), React.createElement(EmailInput, {\n    value: email,\n    name: \"email\",\n    placeholder: \"Type your email\",\n    handleChange: setEmail,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 99\n    },\n    __self: this\n  })), React.createElement(\"span\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 106\n    },\n    __self: this\n  }, React.createElement(LabelStyle, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 107\n    },\n    __self: this\n  }, \"Password\"), React.createElement(PwdInput, {\n    value: password,\n    name: \"password\",\n    placeholder: \"Type your password\",\n    handleChange: setPassword,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 108\n    },\n    __self: this\n  })), React.createElement(ButtonStyle, {\n    type: \"submit\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 115\n    },\n    __self: this\n  }, \"Log in\"));\n};\n\nexport default LoginForm;","map":{"version":3,"sources":["/home/yamakasi/React/react_chat_socketio/src/components/forms/LoginForm.jsx"],"names":["React","useState","useEffect","styled","useAppHooks","AUTH_FAILED","RESET_ERROR","CONNECTED","EmailInput","PwdInput","api","storeToken","axios","FormStyle","form","LabelStyle","label","ButtonStyle","button","LoginForm","useAuth","history","error","isConnected","dispatch","email","setEmail","password","setPassword","errorLogin","setError","handleSubmit","e","preventDefault","user","login","res","type","prevError","message","payload","response","data","console","log","alert","msg","replace"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport styled from \"styled-components\";\r\nimport { useAppHooks } from \"../../contexts\";\r\nimport {\r\n  AUTH_FAILED,\r\n  RESET_ERROR,\r\n  CONNECTED\r\n} from \"../../reducers/authReducer\";\r\nimport EmailInput from \"../inputs/EmailInput\";\r\nimport PwdInput from \"../inputs/PwdInput\";\r\nimport api from \"../../api\";\r\nimport storeToken from \"../../utils/storeToken\";\r\nimport axios from \"axios\";\r\n\r\nconst FormStyle = styled.form`\r\n  padding: 0 10px 20px;\r\n  display: flex;\r\n  flex-direction: column;\r\n\r\n  & span {\r\n    margin: 10px 0;\r\n  }\r\n`;\r\n\r\nconst LabelStyle = styled.label`\r\n  margin-right: 10px;\r\n`;\r\n\r\nconst ButtonStyle = styled.button`\r\n  background-color: forestgreen;\r\n  color: white;\r\n  margin-top: 15px;\r\n  border-radius: 5px;\r\n  padding: 3px;\r\n  border: none;\r\n  box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.4);\r\n`;\r\n\r\nconst LoginForm = () => {\r\n  const { useAuth, history } = useAppHooks();\r\n  const [{ error, isConnected }, dispatch] = useAuth;\r\n\r\n  const [email, setEmail] = useState(null);\r\n  const [password, setPassword] = useState(null);\r\n  const [errorLogin, setError] = useState(null);\r\n\r\n  const handleSubmit = async e => {\r\n    e.preventDefault();\r\n    try {\r\n      if (email && password) {\r\n        const res = await api.user.login(email, password);\r\n        storeToken(res);\r\n        dispatch({ type: CONNECTED });\r\n\r\n        setEmail(null);\r\n        setPassword(null);\r\n      } else if (!email) {\r\n        setError(prevError => ({ ...prevError, email: {message: \"Username is required\"} }));\r\n      } else if (!password) {\r\n        setError(prevError => ({ ...prevError, password: {message: \"Password is required\"} }));\r\n      }\r\n    } catch (error) {\r\n      dispatch({\r\n        type: AUTH_FAILED,\r\n        payload: error.response.data\r\n      });\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (error) setError(error);\r\n    return () => dispatch({ type: RESET_ERROR });\r\n  }, [error, dispatch]);\r\n\r\n  useEffect(() => {\r\n    if (errorLogin) {\r\n      console.log(errorLogin)\r\n      if (errorLogin.email) {\r\n        alert(errorLogin.email.message);\r\n      } else if (errorLogin.password) {\r\n        alert(errorLogin.password.message);\r\n      } else if (errorLogin.msg) {\r\n        alert(errorLogin.msg);\r\n      }\r\n    }\r\n    return () => setError(null);\r\n  }, [errorLogin]);\r\n\r\n  useEffect(() => {\r\n    if (isConnected) {\r\n      history.replace(\"/\");\r\n    }\r\n  }, [isConnected, history]);\r\n\r\n  return (\r\n    <FormStyle onSubmit={handleSubmit}>\r\n      <span>\r\n        <LabelStyle>Email</LabelStyle>\r\n        <EmailInput\r\n          value={email}\r\n          name=\"email\"\r\n          placeholder=\"Type your email\"\r\n          handleChange={setEmail}\r\n        />\r\n      </span>\r\n      <span>\r\n        <LabelStyle>Password</LabelStyle>\r\n        <PwdInput\r\n          value={password}\r\n          name=\"password\"\r\n          placeholder=\"Type your password\"\r\n          handleChange={setPassword}\r\n        />\r\n      </span>\r\n      <ButtonStyle type=\"submit\">Log in</ButtonStyle>\r\n    </FormStyle>\r\n  );\r\n};\r\n\r\nexport default LoginForm;\r\n"]},"metadata":{},"sourceType":"module"}