{"ast":null,"code":"import _slicedToArray from \"/home/yamakasi/React/react_chat_socketio/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _objectWithoutProperties from \"/home/yamakasi/React/react_chat_socketio/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties\";\nimport _taggedTemplateLiteral from \"/home/yamakasi/React/react_chat_socketio/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";\nvar _jsxFileName = \"/home/yamakasi/React/react_chat_socketio/src/components/auth-routes/AuthRoute.jsx\";\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"\\n  width: 100%;\\n  max-height: 100vh;\\n  padding: 0;\\n  margin: 0;\\n  display: grid;\\n  grid-template-columns: 30% 70%;\\n  z-index: 0;\\n  position: relative;\\n\\n  @media \", \" {\\n    grid-template-columns: 40% 60%;\\n  }\\n\\n  @media \", \" {\\n    grid-template-columns: 35% 65%;\\n  }\\n\\n  @media \", \" {\\n    width: 200vw;\\n    position: absolute;\\n    display: grid;\\n    grid-template-columns: 50% 50%;\\n    left: 0;\\n    transform: translateX(\", \"vw);\\n    transition: all 600ms ease-in;\\n  }\\n\"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\nimport React from \"react\";\nimport { Route, Redirect, Switch } from \"react-router-dom\";\nimport jwt from \"jsonwebtoken\";\nimport styled from \"styled-components\";\nimport devices from \"../../utils/devices\";\nimport { useAppHooks } from \"../../contexts\";\nimport { SET_CURRENT_PROFILE, DISCONNECT } from \"../../reducers/authReducer\";\nimport setAuth from \"../../utils/setAuth\";\nimport Sidenav from \"../sidenav/Sidenav\";\nvar secret = process.env.REACT_APP_SECRET || process.env.REACT_APP_SECRET_DEV;\nvar PageStyle = styled.div(_templateObject(), devices.tablet, devices.tablet, devices.mobileL, function (props) {\n  return props.isSelected ? -100 : 0;\n});\n\nvar AuthRoute = function AuthRoute(_ref) {\n  var Component = _ref.component,\n      rest = _objectWithoutProperties(_ref, [\"component\"]);\n\n  var _useAppHooks = useAppHooks(),\n      useAuth = _useAppHooks.useAuth,\n      useTransition = _useAppHooks.useTransition,\n      socket = _useAppHooks.socket;\n\n  var _useAuth = _slicedToArray(useAuth, 2),\n      _useAuth$ = _useAuth[0],\n      isConnected = _useAuth$.isConnected,\n      user = _useAuth$.user,\n      dispatch = _useAuth[1];\n\n  var _useTransition = _slicedToArray(useTransition, 2),\n      chatSelected = _useTransition[0].chatSelected,\n      _ = _useTransition[1];\n\n  var _React$useState = React.useState(true),\n      _React$useState2 = _slicedToArray(_React$useState, 2),\n      isLoaded = _React$useState2[0],\n      setLoading = _React$useState2[1];\n\n  React.useEffect(function () {\n    if (localStorage.chat_token && !isConnected) {\n      setAuth(localStorage.chat_token);\n      var decoded = jwt.verify(localStorage.chat_token, secret);\n      var currentTime = Date.now() / 1000;\n\n      if (decoded.exp < currentTime) {\n        dispatch({\n          type: DISCONNECT\n        });\n      } else {\n        dispatch({\n          type: SET_CURRENT_PROFILE,\n          payload: decoded\n        });\n      }\n    } else if (!localStorage.chat_token) {\n      dispatch({\n        type: DISCONNECT\n      });\n    }\n\n    setLoading(false);\n  }, [localStorage.chat_token, dispatch, isConnected]);\n  React.useEffect(function () {\n    if (isConnected) {\n      socket.emit(\"user-emit\", {\n        userId: user.id,\n        socketId: socket.id\n      });\n    }\n\n    setLoading(false);\n  }, [isConnected, socket, user]);\n  return React.createElement(React.Fragment, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 74\n    },\n    __self: this\n  }, isLoaded && React.createElement(\"div\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 75\n    },\n    __self: this\n  }, \"Loading...\"), !isLoaded && isConnected && React.createElement(Route, Object.assign({}, rest, {\n    render: function render(props) {\n      return React.createElement(PageStyle, {\n        isSelected: chatSelected,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 82\n        },\n        __self: this\n      }, React.createElement(Sidenav, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 83\n        },\n        __self: this\n      }), React.createElement(Component, Object.assign({}, props, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 84\n        },\n        __self: this\n      })));\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 78\n    },\n    __self: this\n  })), !isLoaded && !isConnected && React.createElement(Redirect, {\n    to: \"/login\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 90\n    },\n    __self: this\n  }));\n};\n\nexport default AuthRoute;","map":{"version":3,"sources":["/home/yamakasi/React/react_chat_socketio/src/components/auth-routes/AuthRoute.jsx"],"names":["React","Route","Redirect","Switch","jwt","styled","devices","useAppHooks","SET_CURRENT_PROFILE","DISCONNECT","setAuth","Sidenav","secret","process","env","REACT_APP_SECRET","REACT_APP_SECRET_DEV","PageStyle","div","tablet","mobileL","props","isSelected","AuthRoute","Component","component","rest","useAuth","useTransition","socket","isConnected","user","dispatch","chatSelected","_","useState","isLoaded","setLoading","useEffect","localStorage","chat_token","decoded","verify","currentTime","Date","now","exp","type","payload","emit","userId","id","socketId"],"mappings":"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","sourcesContent":["import React from \"react\";\r\nimport { Route, Redirect, Switch } from \"react-router-dom\";\r\nimport jwt from \"jsonwebtoken\";\r\nimport styled from \"styled-components\";\r\nimport devices from \"../../utils/devices\";\r\nimport { useAppHooks } from \"../../contexts\";\r\nimport { SET_CURRENT_PROFILE, DISCONNECT } from \"../../reducers/authReducer\";\r\nimport setAuth from \"../../utils/setAuth\";\r\nimport Sidenav from \"../sidenav/Sidenav\";\r\n\r\nconst secret = process.env.REACT_APP_SECRET || process.env.REACT_APP_SECRET_DEV;\r\n\r\nconst PageStyle = styled.div`\r\n  width: 100%;\r\n  max-height: 100vh;\r\n  padding: 0;\r\n  margin: 0;\r\n  display: grid;\r\n  grid-template-columns: 30% 70%;\r\n  z-index: 0;\r\n  position: relative;\r\n\r\n  @media ${devices.tablet} {\r\n    grid-template-columns: 40% 60%;\r\n  }\r\n\r\n  @media ${devices.tablet} {\r\n    grid-template-columns: 35% 65%;\r\n  }\r\n\r\n  @media ${devices.mobileL} {\r\n    width: 200vw;\r\n    position: absolute;\r\n    display: grid;\r\n    grid-template-columns: 50% 50%;\r\n    left: 0;\r\n    transform: translateX(${props => (props.isSelected ? -100 : 0)}vw);\r\n    transition: all 600ms ease-in;\r\n  }\r\n`;\r\n\r\nconst AuthRoute = ({ component: Component, ...rest }) => {\r\n  const { useAuth, useTransition, socket } = useAppHooks();\r\n  const [{ isConnected, user }, dispatch] = useAuth;\r\n  const [{ chatSelected }, _] = useTransition;\r\n\r\n  const [isLoaded, setLoading] = React.useState(true);\r\n\r\n  React.useEffect(() => {\r\n    if (localStorage.chat_token && !isConnected) {\r\n      setAuth(localStorage.chat_token);\r\n      const decoded = jwt.verify(localStorage.chat_token, secret);\r\n      const currentTime = Date.now() / 1000;\r\n      if (decoded.exp < currentTime) {\r\n        dispatch({ type: DISCONNECT });\r\n      } else {\r\n        dispatch({ type: SET_CURRENT_PROFILE, payload: decoded });\r\n      }\r\n    }\r\n    else if (!localStorage.chat_token) {\r\n      dispatch({ type: DISCONNECT })\r\n    }\r\n    setLoading(false);\r\n  }, [localStorage.chat_token, dispatch, isConnected]);\r\n\r\n  React.useEffect(() => {\r\n    if (isConnected) {\r\n      socket.emit(\"user-emit\", { userId: user.id, socketId: socket.id });\r\n    }\r\n    setLoading(false);\r\n  }, [isConnected, socket, user]);\r\n\r\n  return (\r\n    <React.Fragment>\r\n      {isLoaded && <div>Loading...</div>}\r\n      {\r\n        !isLoaded && isConnected &&\r\n        <Route\r\n          {...rest}\r\n          render={\r\n            props => (\r\n              <PageStyle isSelected={chatSelected}>\r\n                <Sidenav />\r\n                <Component {...props} />\r\n              </PageStyle>\r\n            )\r\n          }\r\n        />\r\n      }\r\n      {!isLoaded && !isConnected && <Redirect to=\"/login\" />}\r\n    </React.Fragment>\r\n  );\r\n};\r\n\r\nexport default AuthRoute;\r\n"]},"metadata":{},"sourceType":"module"}