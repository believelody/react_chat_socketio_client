{"ast":null,"code":"import _slicedToArray from \"/home/yamakasi/React/react_chat_socketio/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _taggedTemplateLiteral from \"/home/yamakasi/React/react_chat_socketio/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";\nvar _jsxFileName = \"/home/yamakasi/React/react_chat_socketio/src/components/messages/MessageList.jsx\";\n\nfunction _templateObject2() {\n  var data = _taggedTemplateLiteral([\"\\n  width: 100%;\\n  height: 50px;\\n  color: black;\\n  // background-color: rgba(255, 255, 255, .4);\\n  text-align: center;\\n  line-height: 50px;\\n  font-size: 1.7em;\\n\"]);\n\n  _templateObject2 = function _templateObject2() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"\\n  margin: 50px 0px 140px;\\n  padding: 10px 10px 50px;\\n  display: block;\\n  list-style: none;\\n  height: calc(100vh - 130px);\\n  width: 100%;\\n  position: relative;\\n  bottom: 0;\\n  overflow-y: scroll;\\n  // scroll-behavior: smooth;\\n\"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\nimport React, { useState, useEffect } from \"react\";\nimport styled from \"styled-components\";\nimport MessageItem from \"./MessageItem\";\nimport { useAppHooks } from \"../../contexts\";\nimport { socketOn } from \"../../socket\";\nimport Moment from \"react-moment\";\nvar MessageListStyle = styled.ul(_templateObject());\nvar MessageDate = styled.div(_templateObject2());\n\nvar MessageSortedByDate = function MessageSortedByDate(_ref) {\n  var messages = _ref.messages,\n      contact = _ref.contact;\n  var dates = [];\n\n  var day = function day(date) {\n    return new Date(date).getDate();\n  };\n\n  var month = function month(date) {\n    return new Date(date).getMonth();\n  };\n\n  var year = function year(date) {\n    return new Date(date).getFullYear();\n  };\n\n  dates = messages.reduce(function (m, d) {\n    m.push(d.createdAt);\n    console.log(day(d.createdAt));\n    console.log(day(m));\n    console.log(day(d.createdAt) !== day(m));\n\n    if (d && day(d.createdAt) !== day(m) || month(d.createdAt) !== month(m) || year(d.createdAt) !== year(m)) {\n      m.push(d.createdAt);\n    }\n\n    return m;\n  }, []);\n  console.log(dates.length);\n  return dates.map(function (date) {\n    return React.createElement(React.Fragment, {\n      key: date,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 51\n      },\n      __self: this\n    }, React.createElement(MessageDate, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 52\n      },\n      __self: this\n    }, React.createElement(Moment, {\n      format: \"D MMM YYYY\",\n      date: date,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 53\n      },\n      __self: this\n    })), messages.filter(function (message) {\n      return day(date) === day(message.createdAt) || month(date) === month(message.createdAt) || year(date) === year(message.createdAt);\n    }).map(function (message) {\n      return React.createElement(MessageItem, {\n        key: message.id,\n        contact: contact,\n        message: message,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 59\n        },\n        __self: this\n      });\n    }));\n  });\n};\n\nvar MessageList = function MessageList(_ref2) {\n  var chat = _ref2.chat;\n\n  var _useAppHooks = useAppHooks(),\n      useAuth = _useAppHooks.useAuth,\n      socket = _useAppHooks.socket;\n\n  var _useAuth = _slicedToArray(useAuth, 2),\n      user = _useAuth[0].user,\n      _ = _useAuth[1];\n\n  var messagesRef = React.useRef();\n\n  var _useState = useState(chat.messages),\n      _useState2 = _slicedToArray(_useState, 2),\n      messages = _useState2[0],\n      setMessages = _useState2[1];\n\n  var _useState3 = useState(chat.users),\n      _useState4 = _slicedToArray(_useState3, 2),\n      users = _useState4[0],\n      setUsers = _useState4[1];\n\n  var contact = users.find(function (u) {\n    return u.name !== user.name;\n  });\n  socketOn('fetch-messages', socket, messages, function (data, messages) {\n    if (data.chatId === chat.id && messages.length !== data.messages.length) {\n      setMessages(data.messages);\n    }\n  });\n  useEffect(function () {\n    if (messagesRef) {\n      messagesRef.current.scrollTo(0, messagesRef.current.scrollHeight);\n    }\n  }, [messages]);\n  return React.createElement(MessageListStyle, {\n    ref: messagesRef,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 89\n    },\n    __self: this\n  }, messages.length > 0 && React.createElement(MessageSortedByDate, {\n    contact: contact,\n    messages: messages,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 92\n    },\n    __self: this\n  }));\n};\n\nexport default MessageList;","map":{"version":3,"sources":["/home/yamakasi/React/react_chat_socketio/src/components/messages/MessageList.jsx"],"names":["React","useState","useEffect","styled","MessageItem","useAppHooks","socketOn","Moment","MessageListStyle","ul","MessageDate","div","MessageSortedByDate","messages","contact","dates","day","date","Date","getDate","month","getMonth","year","getFullYear","reduce","m","d","push","createdAt","console","log","length","map","filter","message","id","MessageList","chat","useAuth","socket","user","_","messagesRef","useRef","setMessages","users","setUsers","find","u","name","data","chatId","current","scrollTo","scrollHeight"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport styled from \"styled-components\";\r\nimport MessageItem from \"./MessageItem\";\r\nimport { useAppHooks } from \"../../contexts\";\r\nimport { socketOn } from \"../../socket\";\r\nimport Moment from \"react-moment\";\r\n\r\nconst MessageListStyle = styled.ul`\r\n  margin: 50px 0px 140px;\r\n  padding: 10px 10px 50px;\r\n  display: block;\r\n  list-style: none;\r\n  height: calc(100vh - 130px);\r\n  width: 100%;\r\n  position: relative;\r\n  bottom: 0;\r\n  overflow-y: scroll;\r\n  // scroll-behavior: smooth;\r\n`;\r\n\r\nconst MessageDate = styled.div`\r\n  width: 100%;\r\n  height: 50px;\r\n  color: black;\r\n  // background-color: rgba(255, 255, 255, .4);\r\n  text-align: center;\r\n  line-height: 50px;\r\n  font-size: 1.7em;\r\n`\r\n\r\nconst MessageSortedByDate = ({ messages, contact }) => {\r\n  let dates = []\r\n  const day = date => new Date(date).getDate()\r\n  const month = date => new Date(date).getMonth()\r\n  const year = date => new Date(date).getFullYear()\r\n  \r\n  dates = messages.reduce(function(m, d) {\r\n    m.push(d.createdAt)\r\n    console.log(day(d.createdAt))\r\n    console.log(day(m))\r\n    console.log(day(d.createdAt) !== day(m))\r\n    if (d && day(d.createdAt) !== day(m) || month(d.createdAt) !== month(m) || year(d.createdAt) !== year(m)) {\r\n      m.push(d.createdAt)\r\n    }\r\n    return m\r\n  }, [])\r\n\r\n  console.log(dates.length)\r\n  \r\n  return dates.map(date =>\r\n    <React.Fragment key={date}>\r\n      <MessageDate>\r\n        <Moment format=\"D MMM YYYY\" date={date} />\r\n      </MessageDate>\r\n      {\r\n        messages\r\n          .filter(message => day(date) === day(message.createdAt) || month(date) === month(message.createdAt) || year(date) === year(message.createdAt))\r\n          .map(message => (\r\n            <MessageItem key={message.id} contact={contact} message={message} />\r\n          )\r\n        )\r\n      }\r\n    </React.Fragment>\r\n  )\r\n}\r\n\r\nconst MessageList = ({ chat }) => {\r\n  const { useAuth, socket } = useAppHooks()\r\n  const [{user},_] = useAuth\r\n  const messagesRef = React.useRef();\r\n  \r\n  const [messages, setMessages] = useState(chat.messages)\r\n  const [users, setUsers] = useState(chat.users)\r\n  const contact = users.find(u => u.name !== user.name);\r\n\r\n  socketOn('fetch-messages', socket, messages, (data, messages) => {\r\n    if (data.chatId === chat.id && messages.length !== data.messages.length) {\r\n      setMessages(data.messages)\r\n    }\r\n  })\r\n\r\n  useEffect(() => {\r\n    if (messagesRef) {\r\n      messagesRef.current.scrollTo(0, messagesRef.current.scrollHeight)\r\n    }\r\n  }, [messages])\r\n\r\n  return (\r\n    <MessageListStyle ref={messagesRef}>\r\n      {\r\n        messages.length > 0 && \r\n        <MessageSortedByDate contact={contact} messages={messages} />\r\n      }\r\n    </MessageListStyle>\r\n  );\r\n};\r\n\r\nexport default MessageList;\r\n"]},"metadata":{},"sourceType":"module"}